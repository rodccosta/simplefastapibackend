<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <title>Cadastramento de Usu√°rios</title>
    <link rel="stylesheet" href="/static/style.css" />

</head>

<body>

    <div class="container">
        <h1>Cadastramento de Usu√°rios</h1>

        <div class="nav-buttons">
            <button id="firstBtn">‚èÆ</button>
            <button id="prevBtn">‚óÄ</button>
            <button id="addBtn">‚ûï</button>
            <button id="nextBtn">‚ñ∂</button>
            <button id="lastBtn">‚è≠</button>
        </div>

        <div class="form-card">
            <div class="form">
                <div class="form-row">
                    <label for="id">Id</label>
                    <input id="id" type="text" disabled />
                </div>
                <div class="form-row">
                    <label for="name">Nome</label>
                    <input id="name" type="text" disabled />
                </div>
                <div class="form-row">
                    <label for="birthday">Data de Anivers√°rio</label>
                    <input id="birthday" type="date" disabled />
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button id="editBtn">‚úèÔ∏è editar</button>
            <button id="removeBtn">‚ùå remover</button>
            <button id="cancelBtn" style="display: none">üîô cancelar</button>
            <button id="saveBtn" style="display: none">üíæ salvar</button>
        </div>
    </div>

    <script>
        let users = []

        async function loadUsers() {
            try {
                const response = await fetch('/api/person');
                if (!response.ok) throw new Error('Erro ao buscar usu√°rios');
                users = await response.json();
                currentIndex = 0;
                setFormData(users[currentIndex]);
            } catch (error) {
                alert('Erro ao carregar usu√°rios: ' + error.message);
            }
        }

        window.onload = () => {
            loadUsers();

        };

        let currentIndex = 0;

        const fields = [
            "id",
            "name",
            "birthday"
        ];

        const setFormData = (user) => {
            if (user != null) {
                fields.forEach((field) => {
                    document.getElementById(field).value = user[field] || "";
                });
            }
        };

        const toggleEditMode = (editMode) => {
            fields
                .filter((f) => f !== "id") // n√£o edit√°vel
                .forEach((id) => {
                    document.getElementById(id).disabled = !editMode;
                });
            document.getElementById("editBtn").style.display = editMode ? "none" : "inline-block";
            document.getElementById("removeBtn").style.display = editMode ? "none" : "inline-block";
            document.getElementById("cancelBtn").style.display = editMode ? "inline-block" : "none";
            document.getElementById("saveBtn").style.display = editMode ? "inline-block" : "none";
        };

        // Navega√ß√£o
        document.getElementById("firstBtn").onclick = () => {
            currentIndex = 0;
            setFormData(users[currentIndex]);
        };

        document.getElementById("lastBtn").onclick = () => {
            currentIndex = users.length - 1;
            setFormData(users[currentIndex]);
        };

        document.getElementById("prevBtn").onclick = () => {
            if (currentIndex > 0) currentIndex--;
            setFormData(users[currentIndex]);
        };

        document.getElementById("nextBtn").onclick = () => {
            if (currentIndex < users.length - 1) currentIndex++;
            setFormData(users[currentIndex]);
        };

        document.getElementById("addBtn").onclick = () => {
            const emptyUser = {
                id: "",
                name: "",
                birthday: ""
            };
            setFormData(emptyUser);
            toggleEditMode(true);
        };

        // Edi√ß√£o
        document.getElementById("editBtn").onclick = () => toggleEditMode(true);
        document.getElementById("cancelBtn").onclick = () => {
            toggleEditMode(false);
            setFormData(users[currentIndex]);
        };




        document.getElementById("saveBtn").onclick = async () => {
            toggleEditMode(false);
            const field = [
                "name",
                "birthday"];
            try {
                const user = {};
                field.forEach(f => user[f] = document.getElementById(f).value);
                const response = await fetch('/api/person', {
                    method: user.id ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(user)
                });
                if (!response.ok) throw new Error('Erro ao salvar usu√°rios');
                users = await response.json();
                currentIndex = 0;
                setFormData(users[currentIndex]);
                alert("Usu√°rio salvo com sucesso!");
                loadUsers();
            } catch (error) {
                alert('Erro ao salvar usu√°rio: ' + error.message);
            }


            // Exemplo: uso de fetch para salvar (comentado)
            /*
            
            */
        };

        document.getElementById("removeBtn").onclick = async () => {
            if (!confirm("Tem certeza que deseja remover este usu√°rio?")) return;
            try {
                const id = document.getElementById("id").value;
                const response = await fetch(`/api/person/${id}`, { method: "DELETE" });
                if (!response.ok) throw new Error('Erro ao remover usu√°rio');

                alert("Usu√°rio removido com sucesso!");
                loadUsers();

            }
            catch (error) {
                alert('Erro ao remover usu√°rio: ' + error.message);
            }
            // Exemplo: uso de fetch para remover (comentado)
            /*
            
            */
        };

        setFormData(users[currentIndex]);


    </script>
</body>

</html>